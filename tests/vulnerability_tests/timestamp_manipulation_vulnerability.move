// Tests for timestamp manipulation through public function
module tests::timestamp_manipulation {
    use sui::test_scenario;
    use sui::coin::{Self, Coin};
    use sui::clock::{Self, Clock};
    use main::{Self, Leaderboard, ProjectManager};

    #[test]
    #[expected_failure(abort_code = 4)] // Should fail when fix is implemented
    fun test_timestamp_manipulation() {
        let scenario = test_scenario::begin(@0x1);
        let creator = @0x2;
        let attacker = @0x3;

        // Create leaderboard
        test_scenario::next_tx(&mut scenario, creator);
        {
            let manager = main::create_project_manager(test_scenario::ctx(&mut scenario));
            let clock = clock::create_for_testing(test_scenario::ctx(&mut scenario));
            let coin = coin::mint_for_testing(1000, test_scenario::ctx(&mut scenario));
            
            let leaderboard = main::create_leaderboard(
                &mut manager,
                coin,
                1000, // original end timestamp
                test_scenario::ctx(&mut scenario)
            );
            
            test_scenario::return_shared(manager);
            test_scenario::return_shared(leaderboard);
            clock::destroy_for_testing(clock);
        };

        // Attempt to manipulate timestamp as attacker
        test_scenario::next_tx(&mut scenario, attacker);
        {
            let leaderboard = test_scenario::take_shared<Leaderboard>(&scenario);
            
            // Try to extend game time as non-creator
            main::update_end_timestamp(
                &mut leaderboard,
                2000 // new end timestamp
            );
            
            test_scenario::return_shared(leaderboard);
        };
        test_scenario::end(scenario);
    }
} 